---
import { getEntry } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/sections/Hero/Hero.astro";
import CardsSection from "@/components/sections/CardsSection/CardsSection.astro";
import OneLinerSection from "@/components/sections/OneLinerSection/OneLinerSection.astro";
import CtaStripSection from "@/components/sections/CtaStripSection/CtaStripSection.astro";
import { SUPPORTED_LOCALES, DEFAULT_LOCALE, getLocaleOrDefault } from "@/domain";
import type { Locale } from "@/domain";

export async function getStaticPaths() {
  const locales = SUPPORTED_LOCALES.filter((locale) => locale !== DEFAULT_LOCALE);

  return locales.map((locale) => ({
    params: { lang: locale },
  }));
}

const locale: Locale = getLocaleOrDefault(Astro.params.lang);

const heroContent = await getEntry("hero", `${locale}/home`);

if (!heroContent) {
  throw new Error(`Hero content not found: hero/${locale}/home.json`);
}

const { title, subtitle, primaryCta, secondaryCta } = heroContent.data;

// Fetch page sections for current locale
const pageSectionsContent = await getEntry("pageSections", `${locale}/home`);

if (!pageSectionsContent) {
  throw new Error(`Page sections content not found: pageSections/${locale}/home.json`);
}

const { sections } = pageSectionsContent.data;
---

<Layout title={title}>
  <main>
    <Hero title={title} subtitle={subtitle} primaryCta={primaryCta} secondaryCta={secondaryCta} />

    {/* Render all page sections based on type */}
    {
      sections.map((section) => {
        switch (section.type) {
          case "cards":
            return <CardsSection section={section} />;
          case "oneLiner":
            return <OneLinerSection section={section} />;
          case "ctaStrip":
            return <CtaStripSection section={section} />;
        }
      })
    }
  </main>
</Layout>
