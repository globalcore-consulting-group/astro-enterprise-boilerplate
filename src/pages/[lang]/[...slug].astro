---
import Layout from "@/layouts/Layout.astro";
import { SUPPORTED_LOCALES, DEFAULT_LOCALE, getLocaleOrDefault } from "@/domain";
import type { Locale } from "@/domain";
import { t, getRouteSlugs, getRouteKeyFromPath, buildPath } from "@/i18n/translations";

export async function getStaticPaths() {
  const locales = SUPPORTED_LOCALES.filter((locale) => locale !== DEFAULT_LOCALE);

  return locales.flatMap((locale) =>
    getRouteSlugs(locale).map((slug) => ({
      params: { lang: locale, slug },
    }))
  );
}

const locale: Locale = getLocaleOrDefault(Astro.params.lang);
const localizedSlug = Astro.params.slug;

// Extract route key from localized path to determine which page we're on
const routeKey = getRouteKeyFromPath(`/${locale}/${localizedSlug}`);

// Get page title from translations based on route key
const getPageTitle = (): string => {
  if (!routeKey) return "Seite"; // Fallback

  // Map route keys to translation keys
  if (routeKey === "privacy") return t(locale, "footer", "privacyPolicy");
  if (routeKey === "imprint") return t(locale, "footer", "imprint");

  // Default: use nav translation
  return t(locale, "nav", routeKey as any);
};

const title = getPageTitle();

// Check which page type for anchor sections
const isAboutPage = routeKey === "about";
const isServicesPage = routeKey === "services";
const isDomainsPage = routeKey === "domains";
---

<Layout title={title} locale={locale}>
  <main class="container mx-auto px-4 md:px-6 max-w-7xl py-12 md:py-24">
    <div class="max-w-3xl mx-auto text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-foreground mb-6">
        {title}
      </h1>
      <p class="text-lg text-muted-foreground mb-8">{t(locale, "ui", "comingSoon")}</p>
      <a
        href={buildPath("home", locale)}
        class="inline-flex items-center justify-center px-6 py-3 text-base font-medium text-white bg-primary rounded-lg hover:bg-primary/90 transition-colors"
      >
        {t(locale, "ui", "backToHome")}
      </a>
    </div>

    {/* About page - Add "How We Work" section */}
    {
      isAboutPage && (
        <div id="how-we-work" class="mt-24 max-w-3xl mx-auto">
          <h2 class="text-3xl font-bold text-foreground mb-4">{t(locale, "sections", "howWeWork")}</h2>
          <p class="text-muted-foreground">{t(locale, "sections", "howWeWorkContent")}</p>
        </div>
      )
    }

    {/* Services page - Add anchor sections */}
    {
      isServicesPage && (
        <div class="mt-24 max-w-3xl mx-auto space-y-16">
          <div id="frame-sprint">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "frameSprint")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="architect-blueprint">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "architectBlueprint")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="model-validation">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "modelValidation")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="steer-retainer">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "steerRetainer")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>
        </div>
      )
    }

    {/* Domains page - Add anchor sections */}
    {
      isDomainsPage && (
        <div class="mt-24 max-w-3xl mx-auto space-y-16">
          <div id="energy-infrastructure">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "energyInfrastructure")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="digital-cyber">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "digitalCyber")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="finance">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "financeResilience")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="customer-value">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "customerValue")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="health">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "regulatedHealth")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>

          <div id="esg">
            <h2 class="text-2xl font-bold text-foreground mb-2">{t(locale, "sections", "esgData")}</h2>
            <p class="text-muted-foreground">{t(locale, "ui", "contentComingSoon")}</p>
          </div>
        </div>
      )
    }
  </main>
</Layout>
